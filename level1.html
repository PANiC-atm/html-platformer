<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Level 1 - Platformer</title>
  <style>
    body { margin: 0; background: black; display: flex; align-items: center; justify-content: center; height: 100vh; }
    canvas { background: #111; border: 2px solid white; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="450"></canvas>
<script>
// ===== SETUP =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Background
const bg = new Image();
bg.src = "images/levelBG.png";

// Block
const blockImg = new Image();
blockImg.src = "images/level block.png";

// Tile size
const TILE = 32;

// Level data (# = block, . = empty)
const levelData = [
  "............................",
  "............................",
  "............................",
  "............................",
  "............................",
  "............................",
  "............................",
  "............................",
  "..............######........",
  "###############....#########"
];

// Camera
let cameraX = 0;

// Load player script from player.html
// We'll simulate "import" by re-using Player code inline here.
// In real projects, put Player in player.js and include with <script src="player.js">
class Player {
  constructor() {
    this.x = 50;
    this.y = 0;
    this.vx = 0;
    this.vy = 0;
    this.width = 32;
    this.height = 32;
    this.onGround = false;
    this.facing = 1;
    this.state = "idle";
    this.frame = 0;
    this.frameTimer = 0;
    this.canDash = true;
    this.dashing = false;
    this.dashTime = 0;
    this.lockFacing = false;

    // Basic sprite for now (you can hook up HTMLPlayer.png like in player.html)
    this.color = "cyan";
  }

  update() {
    // Gravity
    if (!this.dashing) this.vy += 0.5;

    // Controls
    if (!this.dashing) {
      if (keys["ArrowLeft"]) { this.vx = -3; if (!this.lockFacing) this.facing = -1; }
      else if (keys["ArrowRight"]) { this.vx = 3; if (!this.lockFacing) this.facing = 1; }
      else this.vx = 0;

      if (keys[" "] && this.onGround) {
        this.vy = -10;
        this.onGround = false;
      }

      if (keys["x"] && !this.onGround && this.canDash) {
        this.dashing = true;
        this.dashTime = 15;
        this.vx = this.facing * 12;
        this.vy = 0;
        this.canDash = false;
        this.lockFacing = true;
      }
    }

    // Dash timer
    if (this.dashing) {
      this.dashTime--;
      if (this.dashTime <= 0) {
        this.dashing = false;
        this.lockFacing = false;
      }
    }

    // Apply movement
    this.x += this.vx;
    this.y += this.vy;

    // Collision with tiles
    this.onGround = false;
    for (let row = 0; row < levelData.length; row++) {
      for (let col = 0; col < levelData[row].length; col++) {
        if (levelData[row][col] === "#") {
          let tx = col * TILE;
          let ty = row * TILE;
          if (this.x < tx + TILE &&
              this.x + this.width > tx &&
              this.y < ty + TILE &&
              this.y + this.height > ty) {
            // Simple ground collision
            if (this.vy > 0 && this.y + this.height - this.vy <= ty) {
              this.y = ty - this.height;
              this.vy = 0;
              this.onGround = true;
              this.canDash = true;
            }
          }
        }
      }
    }

    // Update camera
    cameraX = this.x - canvas.width/2 + this.width/2;
    if (cameraX < 0) cameraX = 0;
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x - cameraX, this.y, this.width, this.height);
  }
}

const player = new Player();

// Keys
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ===== LOOP =====
function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background (repeat)
  for (let x = -cameraX; x < canvas.width; x += 256) {
    for (let y = 0; y < canvas.height; y += 192) {
      ctx.drawImage(bg, x, y, 256, 192);
    }
  }

  // Draw level
  for (let row = 0; row < levelData.length; row++) {
    for (let col = 0; col < levelData[row].length; col++) {
      if (levelData[row][col] === "#") {
        ctx.drawImage(blockImg, col*TILE - cameraX, row*TILE, TILE, TILE);
      }
    }
  }

  // Player
  player.update();
  player.draw();

  // HUD - show level counter
  let levelCounter = parseInt(localStorage.getItem("level") || "1");
  ctx.fillStyle = "white";
  ctx.font = "20px sans-serif";
  ctx.fillText("Level " + levelCounter, canvas.width - 120, 30);

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
