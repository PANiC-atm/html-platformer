<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player Test - Platformer</title>
  <style>
    body { margin: 0; background: #111; display: flex; align-items: center; justify-content: center; height: 100vh; }
    canvas { background: #222; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="450"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Player sprite sheets
const sprites = {
  idle: { src: "images/HTMLPlayer.png", frames: 4, w: 2, h: 2 },
  jump: { src: "images/HTMLPlayerJump.png", frames: 2, w: 1, h: 2 },
  attack: { src: "images/HTMLPlayerAtk.png", frames: 4, w: 2, h: 2 },
  dash: { src: "images/HTMLPlayerDash.png", frames: 4, w: 2, h: 2 }
};

for (let key in sprites) {
  const img = new Image();
  img.src = sprites[key].src;
  sprites[key].img = img;
}

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

class Player {
  constructor() {
    this.x = 200;
    this.y = 300;
    this.vx = 0;
    this.vy = 0;
    this.width = 64;
    this.height = 64;
    this.onGround = false;
    this.facing = 1; // 1 = right, -1 = left
    this.state = "idle";
    this.frame = 0;
    this.frameTimer = 0;
    this.canDash = true;
    this.dashing = false;
    this.dashTime = 0;
    this.lockFacing = false;
  }

  update() {
    // Gravity
    if (!this.dashing) this.vy += 0.5;
    
    // Controls
    if (!this.dashing) {
      if (keys["ArrowLeft"]) { this.vx = -3; if (!this.lockFacing) this.facing = -1; }
      else if (keys["ArrowRight"]) { this.vx = 3; if (!this.lockFacing) this.facing = 1; }
      else this.vx = 0;

      if (keys[" "] && this.onGround) { // Jump
        this.vy = -10;
        this.onGround = false;
        this.state = "jump";
      }

      if (keys["z"]) { // Attack
        this.state = "attack";
      }

      if (keys["x"] && !this.onGround && this.canDash) { // Dash
        this.state = "dash";
        this.dashing = true;
        this.dashTime = 15; // frames
        this.vx = this.facing * 12;
        this.vy = 0;
        this.canDash = false;
        this.lockFacing = true;
      }
    }

    // Handle dash duration
    if (this.dashing) {
      this.dashTime--;
      if (this.dashTime <= 0) {
        this.dashing = false;
        this.lockFacing = false;
      }
    }

    // Apply movement
    this.x += this.vx;
    this.y += this.vy;

    // Simple ground collision
    if (this.y + this.height >= canvas.height - 50) {
      this.y = canvas.height - 50 - this.height;
      this.vy = 0;
      this.onGround = true;
      this.canDash = true; // reset dash on landing
      if (!keys["z"] && !this.dashing) this.state = "idle";
    }

    this.animate();
  }

  animate() {
    this.frameTimer++;
    if (this.frameTimer > 10) {
      this.frameTimer = 0;
      this.frame++;
    }

    let spr = sprites[this.state] || sprites.idle;
    let frameIndex = this.frame % spr.frames;

    let fw = spr.img.width / spr.w;
    let fh = spr.img.height / spr.h;
    let sx = (frameIndex % spr.w) * fw;
    let sy = Math.floor(frameIndex / spr.w) * fh;

    ctx.save();
    ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
    ctx.scale(this.facing, 1);
    ctx.drawImage(spr.img, sx, sy, fw, fh, -this.width/2, -this.height/2, this.width, this.height);
    ctx.restore();
  }
}

const player = new Player();

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw ground
  ctx.fillStyle = "#444";
  ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

  player.update();

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
